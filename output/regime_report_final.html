<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>수급 레짐 스캐너 - 분석 리포트</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        .tooltip {
            position: absolute;
            padding: 12px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            border-radius: 8px;
            pointer-events: none;
            font-size: 14px;
            line-height: 1.5;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            z-index: 1000;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- 헤더 -->
    <header class="bg-gradient-to-r from-blue-600 to-blue-800 text-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 py-6">
            <h1 class="text-3xl font-bold">📊 수급 레짐 스캐너</h1>
            <p class="text-blue-100 mt-2">외국인/기관 투자자 수급 분석 리포트</p>
            <p class="text-blue-200 text-sm mt-1">생성일: 2026-02-14 20:56</p>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 py-8">
        <!-- 요약 카드 -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
            <div class="bg-white rounded-lg shadow p-6">
                <div class="text-sm text-gray-500 mb-1">전체 종목</div>
                <div class="text-3xl font-bold text-gray-900">345</div>
            </div>
            <div class="bg-white rounded-lg shadow p-6">
                <div class="text-sm text-gray-500 mb-1">모멘텀형</div>
                <div class="text-3xl font-bold text-red-600">21</div>
            </div>
            <div class="bg-white rounded-lg shadow p-6">
                <div class="text-sm text-gray-500 mb-1">지속형</div>
                <div class="text-3xl font-bold text-blue-600">120</div>
            </div>
            <div class="bg-white rounded-lg shadow p-6">
                <div class="text-sm text-gray-500 mb-1">전환형</div>
                <div class="text-3xl font-bold text-yellow-600">15</div>
            </div>
        </div>

        <!-- 차트 섹션 -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <!-- 패턴별 분포 -->
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-xl font-bold text-gray-900 mb-4">패턴별 분포</h2>
                <canvas id="patternChart"></canvas>
            </div>

            <!-- 섹터별 평균 점수 -->
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-xl font-bold text-gray-900 mb-4">섹터별 평균 점수 (TOP 10)</h2>
                <canvas id="sectorChart"></canvas>
            </div>
        </div>

        <!-- 최종 결론 테이블 -->
        <div class="bg-white rounded-lg shadow mb-8">
            <div class="px-6 py-4 border-b border-gray-200">
                <h2 class="text-xl font-bold text-gray-900">🎯 종합 추천 순위 TOP 20</h2>
                <p class="text-sm text-gray-600 mt-1">종합점수 = 패턴 점수 + (시그널 개수 × 5점)</p>
            </div>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">종목코드</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">종목명</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">섹터</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">패턴</th>
                            <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">점수</th>
                            <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase">시그널</th>
                            <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">종합점수</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">시그널내용</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        
        <tr class="hover:bg-gray-50">
            <td class="px-4 py-3 text-sm text-gray-900 font-medium">028670</td>
            <td class="px-4 py-3 text-sm text-gray-900 font-semibold">팬오션</td>
            <td class="px-4 py-3 text-sm text-gray-600">해상운수</td>
            <td class="px-4 py-3">
                <span class="px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">
                    지속형
                </span>
            </td>
            <td class="px-4 py-3 text-sm text-gray-900 text-right">82.6</td>
            <td class="px-4 py-3 text-sm text-gray-900 text-center">1</td>
            <td class="px-4 py-3 text-sm text-blue-600 font-semibold text-right">87.6</td>
            <td class="px-4 py-3 text-sm text-gray-600">['가속도 9.5배']</td>
        </tr>
        
        <tr class="hover:bg-gray-50">
            <td class="px-4 py-3 text-sm text-gray-900 font-medium">241710</td>
            <td class="px-4 py-3 text-sm text-gray-900 font-semibold">코스메카코리아</td>
            <td class="px-4 py-3 text-sm text-gray-600">개인생활용품</td>
            <td class="px-4 py-3">
                <span class="px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">
                    지속형
                </span>
            </td>
            <td class="px-4 py-3 text-sm text-gray-900 text-right">77.5</td>
            <td class="px-4 py-3 text-sm text-gray-900 text-center">2</td>
            <td class="px-4 py-3 text-sm text-blue-600 font-semibold text-right">87.5</td>
            <td class="px-4 py-3 text-sm text-gray-600">['MA크로스', '가속도 1104.2배']</td>
        </tr>
        
        <tr class="hover:bg-gray-50">
            <td class="px-4 py-3 text-sm text-gray-900 font-medium">036460</td>
            <td class="px-4 py-3 text-sm text-gray-900 font-semibold">한국가스공사</td>
            <td class="px-4 py-3 text-sm text-gray-600">가스</td>
            <td class="px-4 py-3">
                <span class="px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">
                    지속형
                </span>
            </td>
            <td class="px-4 py-3 text-sm text-gray-900 text-right">85.8</td>
            <td class="px-4 py-3 text-sm text-gray-900 text-center">0</td>
            <td class="px-4 py-3 text-sm text-blue-600 font-semibold text-right">85.8</td>
            <td class="px-4 py-3 text-sm text-gray-600">[]</td>
        </tr>
        
        <tr class="hover:bg-gray-50">
            <td class="px-4 py-3 text-sm text-gray-900 font-medium">056190</td>
            <td class="px-4 py-3 text-sm text-gray-900 font-semibold">에스에프에이</td>
            <td class="px-4 py-3 text-sm text-gray-600">기계</td>
            <td class="px-4 py-3">
                <span class="px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">
                    지속형
                </span>
            </td>
            <td class="px-4 py-3 text-sm text-gray-900 text-right">85.8</td>
            <td class="px-4 py-3 text-sm text-gray-900 text-center">0</td>
            <td class="px-4 py-3 text-sm text-blue-600 font-semibold text-right">85.8</td>
            <td class="px-4 py-3 text-sm text-gray-600">[]</td>
        </tr>
        
        <tr class="hover:bg-gray-50">
            <td class="px-4 py-3 text-sm text-gray-900 font-medium">055550</td>
            <td class="px-4 py-3 text-sm text-gray-900 font-semibold">신한지주</td>
            <td class="px-4 py-3 text-sm text-gray-600">상업은행</td>
            <td class="px-4 py-3">
                <span class="px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">
                    지속형
                </span>
            </td>
            <td class="px-4 py-3 text-sm text-gray-900 text-right">79.7</td>
            <td class="px-4 py-3 text-sm text-gray-900 text-center">1</td>
            <td class="px-4 py-3 text-sm text-blue-600 font-semibold text-right">84.7</td>
            <td class="px-4 py-3 text-sm text-gray-600">['MA크로스']</td>
        </tr>
        
        <tr class="hover:bg-gray-50">
            <td class="px-4 py-3 text-sm text-gray-900 font-medium">257720</td>
            <td class="px-4 py-3 text-sm text-gray-900 font-semibold">실리콘투</td>
            <td class="px-4 py-3 text-sm text-gray-600">온라인쇼핑</td>
            <td class="px-4 py-3">
                <span class="px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">
                    지속형
                </span>
            </td>
            <td class="px-4 py-3 text-sm text-gray-900 text-right">79.3</td>
            <td class="px-4 py-3 text-sm text-gray-900 text-center">1</td>
            <td class="px-4 py-3 text-sm text-blue-600 font-semibold text-right">84.3</td>
            <td class="px-4 py-3 text-sm text-gray-600">['MA크로스']</td>
        </tr>
        
        <tr class="hover:bg-gray-50">
            <td class="px-4 py-3 text-sm text-gray-900 font-medium">316140</td>
            <td class="px-4 py-3 text-sm text-gray-900 font-semibold">우리금융지주</td>
            <td class="px-4 py-3 text-sm text-gray-600">상업은행</td>
            <td class="px-4 py-3">
                <span class="px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">
                    지속형
                </span>
            </td>
            <td class="px-4 py-3 text-sm text-gray-900 text-right">81.9</td>
            <td class="px-4 py-3 text-sm text-gray-900 text-center">0</td>
            <td class="px-4 py-3 text-sm text-blue-600 font-semibold text-right">81.9</td>
            <td class="px-4 py-3 text-sm text-gray-600">[]</td>
        </tr>
        
        <tr class="hover:bg-gray-50">
            <td class="px-4 py-3 text-sm text-gray-900 font-medium">251270</td>
            <td class="px-4 py-3 text-sm text-gray-900 font-semibold">넷마블</td>
            <td class="px-4 py-3 text-sm text-gray-600">게임 소프트웨어</td>
            <td class="px-4 py-3">
                <span class="px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800">
                    모멘텀형
                </span>
            </td>
            <td class="px-4 py-3 text-sm text-gray-900 text-right">76.7</td>
            <td class="px-4 py-3 text-sm text-gray-900 text-center">1</td>
            <td class="px-4 py-3 text-sm text-blue-600 font-semibold text-right">81.7</td>
            <td class="px-4 py-3 text-sm text-gray-600">['MA크로스']</td>
        </tr>
        
        <tr class="hover:bg-gray-50">
            <td class="px-4 py-3 text-sm text-gray-900 font-medium">069620</td>
            <td class="px-4 py-3 text-sm text-gray-900 font-semibold">대웅제약</td>
            <td class="px-4 py-3 text-sm text-gray-600">제약</td>
            <td class="px-4 py-3">
                <span class="px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">
                    지속형
                </span>
            </td>
            <td class="px-4 py-3 text-sm text-gray-900 text-right">71.2</td>
            <td class="px-4 py-3 text-sm text-gray-900 text-center">2</td>
            <td class="px-4 py-3 text-sm text-blue-600 font-semibold text-right">81.2</td>
            <td class="px-4 py-3 text-sm text-gray-600">['MA크로스', '가속도 3.3배']</td>
        </tr>
        
        <tr class="hover:bg-gray-50">
            <td class="px-4 py-3 text-sm text-gray-900 font-medium">011200</td>
            <td class="px-4 py-3 text-sm text-gray-900 font-semibold">HMM</td>
            <td class="px-4 py-3 text-sm text-gray-600">해상운수</td>
            <td class="px-4 py-3">
                <span class="px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">
                    지속형
                </span>
            </td>
            <td class="px-4 py-3 text-sm text-gray-900 text-right">80.4</td>
            <td class="px-4 py-3 text-sm text-gray-900 text-center">0</td>
            <td class="px-4 py-3 text-sm text-blue-600 font-semibold text-right">80.4</td>
            <td class="px-4 py-3 text-sm text-gray-600">[]</td>
        </tr>
        
        <tr class="hover:bg-gray-50">
            <td class="px-4 py-3 text-sm text-gray-900 font-medium">071320</td>
            <td class="px-4 py-3 text-sm text-gray-900 font-semibold">지역난방공사</td>
            <td class="px-4 py-3 text-sm text-gray-600">전력</td>
            <td class="px-4 py-3">
                <span class="px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">
                    지속형
                </span>
            </td>
            <td class="px-4 py-3 text-sm text-gray-900 text-right">79.4</td>
            <td class="px-4 py-3 text-sm text-gray-900 text-center">0</td>
            <td class="px-4 py-3 text-sm text-blue-600 font-semibold text-right">79.4</td>
            <td class="px-4 py-3 text-sm text-gray-600">[]</td>
        </tr>
        
        <tr class="hover:bg-gray-50">
            <td class="px-4 py-3 text-sm text-gray-900 font-medium">005830</td>
            <td class="px-4 py-3 text-sm text-gray-900 font-semibold">DB손해보험</td>
            <td class="px-4 py-3 text-sm text-gray-600">보험</td>
            <td class="px-4 py-3">
                <span class="px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">
                    지속형
                </span>
            </td>
            <td class="px-4 py-3 text-sm text-gray-900 text-right">78.8</td>
            <td class="px-4 py-3 text-sm text-gray-900 text-center">0</td>
            <td class="px-4 py-3 text-sm text-blue-600 font-semibold text-right">78.8</td>
            <td class="px-4 py-3 text-sm text-gray-600">[]</td>
        </tr>
        
        <tr class="hover:bg-gray-50">
            <td class="px-4 py-3 text-sm text-gray-900 font-medium">028260</td>
            <td class="px-4 py-3 text-sm text-gray-900 font-semibold">삼성물산</td>
            <td class="px-4 py-3 text-sm text-gray-600">복합 산업</td>
            <td class="px-4 py-3">
                <span class="px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">
                    지속형
                </span>
            </td>
            <td class="px-4 py-3 text-sm text-gray-900 text-right">73.7</td>
            <td class="px-4 py-3 text-sm text-gray-900 text-center">1</td>
            <td class="px-4 py-3 text-sm text-blue-600 font-semibold text-right">78.7</td>
            <td class="px-4 py-3 text-sm text-gray-600">['가속도 1.7배']</td>
        </tr>
        
        <tr class="hover:bg-gray-50">
            <td class="px-4 py-3 text-sm text-gray-900 font-medium">008930</td>
            <td class="px-4 py-3 text-sm text-gray-900 font-semibold">한미사이언스</td>
            <td class="px-4 py-3 text-sm text-gray-600">제약</td>
            <td class="px-4 py-3">
                <span class="px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">
                    지속형
                </span>
            </td>
            <td class="px-4 py-3 text-sm text-gray-900 text-right">73.7</td>
            <td class="px-4 py-3 text-sm text-gray-900 text-center">1</td>
            <td class="px-4 py-3 text-sm text-blue-600 font-semibold text-right">78.7</td>
            <td class="px-4 py-3 text-sm text-gray-600">['MA크로스']</td>
        </tr>
        
        <tr class="hover:bg-gray-50">
            <td class="px-4 py-3 text-sm text-gray-900 font-medium">014680</td>
            <td class="px-4 py-3 text-sm text-gray-900 font-semibold">한솔케미칼</td>
            <td class="px-4 py-3 text-sm text-gray-600">화학</td>
            <td class="px-4 py-3">
                <span class="px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">
                    지속형
                </span>
            </td>
            <td class="px-4 py-3 text-sm text-gray-900 text-right">78.5</td>
            <td class="px-4 py-3 text-sm text-gray-900 text-center">0</td>
            <td class="px-4 py-3 text-sm text-blue-600 font-semibold text-right">78.5</td>
            <td class="px-4 py-3 text-sm text-gray-600">[]</td>
        </tr>
        
        <tr class="hover:bg-gray-50">
            <td class="px-4 py-3 text-sm text-gray-900 font-medium">450080</td>
            <td class="px-4 py-3 text-sm text-gray-900 font-semibold">에코프로머티</td>
            <td class="px-4 py-3 text-sm text-gray-600">전자 장비 및 기기</td>
            <td class="px-4 py-3">
                <span class="px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">
                    지속형
                </span>
            </td>
            <td class="px-4 py-3 text-sm text-gray-900 text-right">78.4</td>
            <td class="px-4 py-3 text-sm text-gray-900 text-center">0</td>
            <td class="px-4 py-3 text-sm text-blue-600 font-semibold text-right">78.4</td>
            <td class="px-4 py-3 text-sm text-gray-600">[]</td>
        </tr>
        
        <tr class="hover:bg-gray-50">
            <td class="px-4 py-3 text-sm text-gray-900 font-medium">025900</td>
            <td class="px-4 py-3 text-sm text-gray-900 font-semibold">동화기업</td>
            <td class="px-4 py-3 text-sm text-gray-600">건축자재</td>
            <td class="px-4 py-3">
                <span class="px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">
                    지속형
                </span>
            </td>
            <td class="px-4 py-3 text-sm text-gray-900 text-right">78.3</td>
            <td class="px-4 py-3 text-sm text-gray-900 text-center">0</td>
            <td class="px-4 py-3 text-sm text-blue-600 font-semibold text-right">78.3</td>
            <td class="px-4 py-3 text-sm text-gray-600">[]</td>
        </tr>
        
        <tr class="hover:bg-gray-50">
            <td class="px-4 py-3 text-sm text-gray-900 font-medium">032190</td>
            <td class="px-4 py-3 text-sm text-gray-900 font-semibold">다우데이타</td>
            <td class="px-4 py-3 text-sm text-gray-600">증권</td>
            <td class="px-4 py-3">
                <span class="px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">
                    지속형
                </span>
            </td>
            <td class="px-4 py-3 text-sm text-gray-900 text-right">73.2</td>
            <td class="px-4 py-3 text-sm text-gray-900 text-center">1</td>
            <td class="px-4 py-3 text-sm text-blue-600 font-semibold text-right">78.2</td>
            <td class="px-4 py-3 text-sm text-gray-600">['MA크로스']</td>
        </tr>
        
        <tr class="hover:bg-gray-50">
            <td class="px-4 py-3 text-sm text-gray-900 font-medium">001440</td>
            <td class="px-4 py-3 text-sm text-gray-900 font-semibold">대한전선</td>
            <td class="px-4 py-3 text-sm text-gray-600">전기장비</td>
            <td class="px-4 py-3">
                <span class="px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">
                    지속형
                </span>
            </td>
            <td class="px-4 py-3 text-sm text-gray-900 text-right">73.1</td>
            <td class="px-4 py-3 text-sm text-gray-900 text-center">1</td>
            <td class="px-4 py-3 text-sm text-blue-600 font-semibold text-right">78.1</td>
            <td class="px-4 py-3 text-sm text-gray-600">['MA크로스']</td>
        </tr>
        
        <tr class="hover:bg-gray-50">
            <td class="px-4 py-3 text-sm text-gray-900 font-medium">096530</td>
            <td class="px-4 py-3 text-sm text-gray-900 font-semibold">씨젠</td>
            <td class="px-4 py-3 text-sm text-gray-600">의료 장비 및 서비스</td>
            <td class="px-4 py-3">
                <span class="px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">
                    지속형
                </span>
            </td>
            <td class="px-4 py-3 text-sm text-gray-900 text-right">72.5</td>
            <td class="px-4 py-3 text-sm text-gray-900 text-center">1</td>
            <td class="px-4 py-3 text-sm text-blue-600 font-semibold text-right">77.5</td>
            <td class="px-4 py-3 text-sm text-gray-600">['MA크로스']</td>
        </tr>
        
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 섹터별 수급 집중도 -->
        <div class="bg-white rounded-lg shadow">
            <div class="px-6 py-4 border-b border-gray-200">
                <h2 class="text-xl font-bold text-gray-900">🔥 섹터별 수급 집중도 (TOP 10)</h2>
                <p class="text-sm text-gray-600 mt-1">섹터점수 = 평균점수 × (1 + 고득점종목수/전체종목수)</p>
            </div>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">섹터</th>
                            <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">평균 점수</th>
                            <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase">종목 수</th>
                            <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase">고득점 종목</th>
                            <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">섹터 점수</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        
        <tr class="hover:bg-gray-50">
            <td class="px-4 py-3 text-sm text-gray-900 font-medium">상업은행</td>
            <td class="px-4 py-3 text-sm text-gray-900 text-right">75.2</td>
            <td class="px-4 py-3 text-sm text-gray-600 text-center">8</td>
            <td class="px-4 py-3 text-sm text-green-600 font-semibold text-center">7</td>
            <td class="px-4 py-3 text-sm text-blue-600 font-bold text-right">141.0</td>
        </tr>
        
        <tr class="hover:bg-gray-50">
            <td class="px-4 py-3 text-sm text-gray-900 font-medium">디스플레이 및 관련부품</td>
            <td class="px-4 py-3 text-sm text-gray-900 text-right">62.5</td>
            <td class="px-4 py-3 text-sm text-gray-600 text-center">5</td>
            <td class="px-4 py-3 text-sm text-green-600 font-semibold text-center">2</td>
            <td class="px-4 py-3 text-sm text-blue-600 font-bold text-right">87.5</td>
        </tr>
        
        <tr class="hover:bg-gray-50">
            <td class="px-4 py-3 text-sm text-gray-900 font-medium">보험</td>
            <td class="px-4 py-3 text-sm text-gray-900 text-right">63.2</td>
            <td class="px-4 py-3 text-sm text-gray-600 text-center">6</td>
            <td class="px-4 py-3 text-sm text-green-600 font-semibold text-center">2</td>
            <td class="px-4 py-3 text-sm text-blue-600 font-bold text-right">84.2</td>
        </tr>
        
        <tr class="hover:bg-gray-50">
            <td class="px-4 py-3 text-sm text-gray-900 font-medium">의료 장비 및 서비스</td>
            <td class="px-4 py-3 text-sm text-gray-900 text-right">62.5</td>
            <td class="px-4 py-3 text-sm text-gray-600 text-center">12</td>
            <td class="px-4 py-3 text-sm text-green-600 font-semibold text-center">4</td>
            <td class="px-4 py-3 text-sm text-blue-600 font-bold text-right">83.4</td>
        </tr>
        
        <tr class="hover:bg-gray-50">
            <td class="px-4 py-3 text-sm text-gray-900 font-medium">개인생활용품</td>
            <td class="px-4 py-3 text-sm text-gray-900 text-right">65.2</td>
            <td class="px-4 py-3 text-sm text-gray-600 text-center">11</td>
            <td class="px-4 py-3 text-sm text-green-600 font-semibold text-center">3</td>
            <td class="px-4 py-3 text-sm text-blue-600 font-bold text-right">82.9</td>
        </tr>
        
        <tr class="hover:bg-gray-50">
            <td class="px-4 py-3 text-sm text-gray-900 font-medium">복합 산업</td>
            <td class="px-4 py-3 text-sm text-gray-900 text-right">63.4</td>
            <td class="px-4 py-3 text-sm text-gray-600 text-center">7</td>
            <td class="px-4 py-3 text-sm text-green-600 font-semibold text-center">2</td>
            <td class="px-4 py-3 text-sm text-blue-600 font-bold text-right">81.5</td>
        </tr>
        
        <tr class="hover:bg-gray-50">
            <td class="px-4 py-3 text-sm text-gray-900 font-medium">식료품</td>
            <td class="px-4 py-3 text-sm text-gray-900 text-right">63.1</td>
            <td class="px-4 py-3 text-sm text-gray-600 text-center">12</td>
            <td class="px-4 py-3 text-sm text-green-600 font-semibold text-center">3</td>
            <td class="px-4 py-3 text-sm text-blue-600 font-bold text-right">78.9</td>
        </tr>
        
        <tr class="hover:bg-gray-50">
            <td class="px-4 py-3 text-sm text-gray-900 font-medium">전자 장비 및 기기</td>
            <td class="px-4 py-3 text-sm text-gray-900 text-right">57.8</td>
            <td class="px-4 py-3 text-sm text-gray-600 text-center">23</td>
            <td class="px-4 py-3 text-sm text-green-600 font-semibold text-center">6</td>
            <td class="px-4 py-3 text-sm text-blue-600 font-bold text-right">72.9</td>
        </tr>
        
        <tr class="hover:bg-gray-50">
            <td class="px-4 py-3 text-sm text-gray-900 font-medium">제약</td>
            <td class="px-4 py-3 text-sm text-gray-900 text-right">62.5</td>
            <td class="px-4 py-3 text-sm text-gray-600 text-center">20</td>
            <td class="px-4 py-3 text-sm text-green-600 font-semibold text-center">3</td>
            <td class="px-4 py-3 text-sm text-blue-600 font-bold text-right">71.9</td>
        </tr>
        
        <tr class="hover:bg-gray-50">
            <td class="px-4 py-3 text-sm text-gray-900 font-medium">건설</td>
            <td class="px-4 py-3 text-sm text-gray-900 text-right">59.9</td>
            <td class="px-4 py-3 text-sm text-gray-600 text-center">6</td>
            <td class="px-4 py-3 text-sm text-green-600 font-semibold text-center">1</td>
            <td class="px-4 py-3 text-sm text-blue-600 font-bold text-right">69.9</td>
        </tr>
        
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 섹터별 Treemap -->
        <div class="bg-white rounded-lg shadow mt-8">
            <div class="px-6 py-4 border-b border-gray-200">
                <h2 class="text-xl font-bold text-gray-900">🗺️ 섹터별 종목 Treemap</h2>
                <p class="text-sm text-gray-600 mt-1">박스 크기: 종합점수 비례 | 색상: 빨강(낮음) → 노랑(중간) → 초록(높음)</p>
            </div>
            <div class="p-6">
                <div id="heatmap" style="overflow-x: auto;"></div>
            </div>
        </div>
    </main>

    <!-- 푸터 -->
    <footer class="bg-gray-800 text-white mt-12">
        <div class="max-w-7xl mx-auto px-4 py-6 text-center">
            <p class="text-gray-400">수급 레짐 스캐너 v3.1 | Stage 3 완료</p>
            <p class="text-gray-500 text-sm mt-2">KOSPI200 + KOSDAQ150 (345개 종목) | 2024-01-02 ~ 2026-01-20</p>
        </div>
    </footer>

    <!-- Chart.js 스크립트 -->
    <script>
        // 패턴별 분포 차트
        const patternCtx = document.getElementById('patternChart').getContext('2d');
        new Chart(patternCtx, {
            type: 'doughnut',
            data: {
                labels: ["\uae30\ud0c0", "\ubaa8\uba58\ud140\ud615", "\uc804\ud658\ud615", "\uc9c0\uc18d\ud615"],
                datasets: [{
                    data: [189, 21, 15, 120],
                    backgroundColor: ['#EF4444', '#3B82F6', '#F59E0B'],
                    borderWidth: 2,
                    borderColor: '#fff'
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });

        // 섹터별 평균 점수 차트
        const sectorCtx = document.getElementById('sectorChart').getContext('2d');
        new Chart(sectorCtx, {
            type: 'bar',
            data: {
                labels: ["\uac00\uc2a4", "\uc628\ub77c\uc778\uc1fc\ud551", "\ud574\uc0c1\uc6b4\uc218", "\ucc3d\uc5c5\ud22c\uc790 \ubc0f \uc885\uae08", "\uc0c1\uc5c5\uc740\ud589", "\uc804\ub825", "\uac74\ucd95\uc790\uc7ac", "\uc77c\ubc18 \uc18c\ud504\ud2b8\uc6e8\uc5b4", "\uc74c\ub8cc", "\ubb34\uc120\ud1b5\uc2e0"],
                datasets: [{
                    label: '평균 점수',
                    data: [85.83755135394684, 84.31757602265344, 84.013063550493, 75.71748594126345, 75.1781285169665, 72.09917027676732, 70.10723673371365, 69.63832270394421, 68.03011632028623, 66.36348684090613],
                    backgroundColor: '#3B82F6',
                    borderColor: '#2563EB',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                indexAxis: 'y',
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    x: {
                        beginAtZero: true,
                        max: 100
                    }
                }
            }
        });

        // D3 Treemap
        const treemapData = {"name": "root", "children": [{"name": "\uc0c1\uc5c5\uc740\ud589", "children": [{"name": "\uc2e0\ud55c\uc9c0\uc8fc", "value": 84.73986336110431, "stock_code": "055550", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 84.73986336110431, "signal_count": 1, "signal_list": "['MA\ud06c\ub85c\uc2a4']"}, {"name": "\uc6b0\ub9ac\uae08\uc735\uc9c0\uc8fc", "value": 81.86601220108919, "stock_code": "316140", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 81.86601220108919, "signal_count": 0, "signal_list": "[]"}, {"name": "BNK\uae08\uc735\uc9c0\uc8fc", "value": 77.0856637908159, "stock_code": "138930", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 77.0856637908159, "signal_count": 1, "signal_list": "['MA\ud06c\ub85c\uc2a4']"}, {"name": "KB\uae08\uc735", "value": 76.25564377173606, "stock_code": "105560", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 76.25564377173606, "signal_count": 1, "signal_list": "['\uac00\uc18d\ub3c4 1.9\ubc30']"}, {"name": "\uae30\uc5c5\uc740\ud589", "value": 74.5322132337493, "stock_code": "024110", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 74.5322132337493, "signal_count": 1, "signal_list": "['MA\ud06c\ub85c\uc2a4']"}, {"name": "\ud558\ub098\uae08\uc735\uc9c0\uc8fc", "value": 73.12013796659868, "stock_code": "086790", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 73.12013796659868, "signal_count": 0, "signal_list": "[]"}, {"name": "\uce74\uce74\uc624\ubc45\ud06c", "value": 70.76703889798439, "stock_code": "323410", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 70.76703889798439, "signal_count": 1, "signal_list": "['MA\ud06c\ub85c\uc2a4']"}, {"name": "JB\uae08\uc735\uc9c0\uc8fc", "value": 63.05845491265414, "stock_code": "175330", "pattern": "\uae30\ud0c0", "combined_score": 63.05845491265414, "signal_count": 1, "signal_list": "['\uac00\uc18d\ub3c4 8.7\ubc30']"}]}, {"name": "\ub514\uc2a4\ud50c\ub808\uc774 \ubc0f \uad00\ub828\ubd80\ud488", "children": [{"name": "\uc774\ub179\uc2a4\ucca8\ub2e8\uc18c\uc7ac", "value": 70.98816448032562, "stock_code": "272290", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 70.98816448032562, "signal_count": 1, "signal_list": "['MA\ud06c\ub85c\uc2a4']"}, {"name": "\ub355\uc0b0\ub124\uc624\ub8e9\uc2a4", "value": 70.09677386922391, "stock_code": "213420", "pattern": "\ubaa8\uba58\ud140\ud615", "combined_score": 70.09677386922391, "signal_count": 1, "signal_list": "['\uac00\uc18d\ub3c4 1.6\ubc30']"}, {"name": "\uc11c\uc6b8\ubc18\ub3c4\uccb4", "value": 65.31444997423486, "stock_code": "046890", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 65.31444997423486, "signal_count": 0, "signal_list": "[]"}, {"name": "\uc120\uc775\uc2dc\uc2a4\ud15c", "value": 59.26458861708458, "stock_code": "171090", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 59.26458861708458, "signal_count": 0, "signal_list": "[]"}, {"name": "LG\ub514\uc2a4\ud50c\ub808\uc774", "value": 46.89124240485553, "stock_code": "034220", "pattern": "\uae30\ud0c0", "combined_score": 46.89124240485553, "signal_count": 0, "signal_list": "[]"}]}, {"name": "\ubcf4\ud5d8", "children": [{"name": "DB\uc190\ud574\ubcf4\ud5d8", "value": 78.78963870322177, "stock_code": "005830", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 78.78963870322177, "signal_count": 0, "signal_list": "[]"}, {"name": "\uc0bc\uc131\uc0dd\uba85", "value": 70.48882203887592, "stock_code": "032830", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 70.48882203887592, "signal_count": 1, "signal_list": "['MA\ud06c\ub85c\uc2a4']"}, {"name": "\ud604\ub300\ud574\uc0c1", "value": 65.87032867610957, "stock_code": "001450", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 65.87032867610957, "signal_count": 0, "signal_list": "[]"}, {"name": "\uc0bc\uc131\ud654\uc7ac", "value": 63.998236268920415, "stock_code": "000810", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 63.998236268920415, "signal_count": 0, "signal_list": "[]"}, {"name": "\ud55c\ud654\uc0dd\uba85", "value": 58.55083069483896, "stock_code": "088350", "pattern": "\uae30\ud0c0", "combined_score": 58.55083069483896, "signal_count": 1, "signal_list": "['\uac00\uc18d\ub3c4 2.3\ubc30']"}, {"name": "\uc778\uce74\uae08\uc735\uc11c\ube44\uc2a4", "value": 41.22420846757051, "stock_code": "211050", "pattern": "\uae30\ud0c0", "combined_score": 41.22420846757051, "signal_count": 0, "signal_list": "[]"}]}, {"name": "\uc758\ub8cc \uc7a5\ube44 \ubc0f \uc11c\ube44\uc2a4", "children": [{"name": "\uc528\uc820", "value": 77.47966926505698, "stock_code": "096530", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 77.47966926505698, "signal_count": 1, "signal_list": "['MA\ud06c\ub85c\uc2a4']"}, {"name": "\uc140\ubc14\uc2a4AI", "value": 74.76625269200838, "stock_code": "108860", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 74.76625269200838, "signal_count": 1, "signal_list": "['MA\ud06c\ub85c\uc2a4']"}, {"name": "\ucf5c\ub9c8\ube44\uc564\uc5d0\uc774\uce58", "value": 73.50109008902672, "stock_code": "200130", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 73.50109008902672, "signal_count": 0, "signal_list": "[]"}, {"name": "\uc5d0\uc2a4\ub514\ubc14\uc774\uc624\uc13c\uc11c", "value": 71.52458393911246, "stock_code": "137310", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 71.52458393911246, "signal_count": 0, "signal_list": "[]"}, {"name": "HLB", "value": 68.53473368272418, "stock_code": "028300", "pattern": "\ubaa8\uba58\ud140\ud615", "combined_score": 68.53473368272418, "signal_count": 1, "signal_list": "['\uac00\uc18d\ub3c4 4.9\ubc30']"}, {"name": "\ud30c\ub9c8\ub9ac\uc11c\uce58", "value": 66.73744989232429, "stock_code": "214450", "pattern": "\ubaa8\uba58\ud140\ud615", "combined_score": 66.73744989232429, "signal_count": 0, "signal_list": "[]"}, {"name": "\ucc28\ubc14\uc774\uc624\ud14d", "value": 65.13049399170924, "stock_code": "085660", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 65.13049399170924, "signal_count": 1, "signal_list": "['MA\ud06c\ub85c\uc2a4']"}, {"name": "\uc6d0\ud14d", "value": 63.09448697193593, "stock_code": "336570", "pattern": "\uae30\ud0c0", "combined_score": 63.09448697193593, "signal_count": 0, "signal_list": "[]"}, {"name": "\ud074\ub798\uc2dc\uc2a4", "value": 56.81294684968198, "stock_code": "214150", "pattern": "\uc804\ud658\ud615", "combined_score": 56.81294684968198, "signal_count": 0, "signal_list": "[]"}, {"name": "\ub8e8\ub2db", "value": 47.769828850871626, "stock_code": "328130", "pattern": "\uae30\ud0c0", "combined_score": 47.769828850871626, "signal_count": 0, "signal_list": "[]"}]}, {"name": "\uac1c\uc778\uc0dd\ud65c\uc6a9\ud488", "children": [{"name": "\ucf54\uc2a4\uba54\uce74\ucf54\ub9ac\uc544", "value": 87.51048859451105, "stock_code": "241710", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 87.51048859451105, "signal_count": 2, "signal_list": "['MA\ud06c\ub85c\uc2a4', '\uac00\uc18d\ub3c4 1104.2\ubc30']"}, {"name": "LG\uc0dd\ud65c\uac74\uac15", "value": 75.50383816859852, "stock_code": "051900", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 75.50383816859852, "signal_count": 0, "signal_list": "[]"}, {"name": "\uc528\uc564\uc528\uc778\ud130\ub0b4\uc154\ub110", "value": 70.45287796134559, "stock_code": "352480", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 70.45287796134559, "signal_count": 1, "signal_list": "['MA\ud06c\ub85c\uc2a4']"}, {"name": "\uc544\ubaa8\ub808\ud37c\uc2dc\ud53d\ud640\ub529\uc2a4", "value": 69.4493567394735, "stock_code": "002790", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 69.4493567394735, "signal_count": 1, "signal_list": "['MA\ud06c\ub85c\uc2a4']"}, {"name": "\ud55c\uad6d\ucf5c\ub9c8", "value": 66.01991866849716, "stock_code": "161890", "pattern": "\uae30\ud0c0", "combined_score": 66.01991866849716, "signal_count": 1, "signal_list": "['MA\ud06c\ub85c\uc2a4']"}, {"name": "\ube0c\uc774\ud2f0", "value": 65.84508363305848, "stock_code": "018290", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 65.84508363305848, "signal_count": 0, "signal_list": "[]"}, {"name": "\uc544\ubaa8\ub808\ud37c\uc2dc\ud53d", "value": 62.991060049097115, "stock_code": "090430", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 62.991060049097115, "signal_count": 0, "signal_list": "[]"}, {"name": "\ud604\ub300\ubc14\uc774\uc624", "value": 60.00663333714683, "stock_code": "048410", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 60.00663333714683, "signal_count": 0, "signal_list": "[]"}, {"name": "\ucf00\uc5b4\uc820", "value": 50.52807335204245, "stock_code": "214370", "pattern": "\uae30\ud0c0", "combined_score": 50.52807335204245, "signal_count": 0, "signal_list": "[]"}, {"name": "\ucf54\uc2a4\ub9e5\uc2a4", "value": 43.22827049202307, "stock_code": "192820", "pattern": "\uae30\ud0c0", "combined_score": 43.22827049202307, "signal_count": 0, "signal_list": "[]"}]}, {"name": "\ubcf5\ud569 \uc0b0\uc5c5", "children": [{"name": "\uc0bc\uc131\ubb3c\uc0b0", "value": 78.69265638336496, "stock_code": "028260", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 78.69265638336496, "signal_count": 1, "signal_list": "['\uac00\uc18d\ub3c4 1.7\ubc30']"}, {"name": "\ub86f\ub370\uc9c0\uc8fc", "value": 71.50706123480462, "stock_code": "004990", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 71.50706123480462, "signal_count": 0, "signal_list": "[]"}, {"name": "\ub450\uc0b0", "value": 69.62708086684901, "stock_code": "000150", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 69.62708086684901, "signal_count": 0, "signal_list": "[]"}, {"name": "\ud55c\ud654", "value": 61.81428171737296, "stock_code": "000880", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 61.81428171737296, "signal_count": 0, "signal_list": "[]"}, {"name": "CJ", "value": 57.41816241909564, "stock_code": "001040", "pattern": "\uc804\ud658\ud615", "combined_score": 57.41816241909564, "signal_count": 1, "signal_list": "['\uac00\uc18d\ub3c4 2.5\ubc30']"}, {"name": "SK\uc2a4\ud018\uc5b4", "value": 56.41087527640258, "stock_code": "402340", "pattern": "\uae30\ud0c0", "combined_score": 56.41087527640258, "signal_count": 1, "signal_list": "['\uac00\uc18d\ub3c4 1.5\ubc30']"}, {"name": "LG", "value": 48.05000874281484, "stock_code": "003550", "pattern": "\uae30\ud0c0", "combined_score": 48.05000874281484, "signal_count": 0, "signal_list": "[]"}]}, {"name": "\uc2dd\ub8cc\ud488", "children": [{"name": "\uc624\ub69c\uae30", "value": 76.033474924805, "stock_code": "007310", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 76.033474924805, "signal_count": 0, "signal_list": "[]"}, {"name": "\uc624\ub9ac\uc628\ud640\ub529\uc2a4", "value": 73.30204806949702, "stock_code": "001800", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 73.30204806949702, "signal_count": 0, "signal_list": "[]"}, {"name": "CJ\uc81c\uc77c\uc81c\ub2f9", "value": 71.9888868638113, "stock_code": "097950", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 71.9888868638113, "signal_count": 0, "signal_list": "[]"}, {"name": "\ub18d\uc2ec", "value": 65.93165344254889, "stock_code": "004370", "pattern": "\ubaa8\uba58\ud140\ud615", "combined_score": 65.93165344254889, "signal_count": 0, "signal_list": "[]"}, {"name": "\uc0bc\uc591\uc2dd\ud488", "value": 65.78864585976369, "stock_code": "003230", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 65.78864585976369, "signal_count": 0, "signal_list": "[]"}, {"name": "\uc624\ub9ac\uc628", "value": 64.11314403406145, "stock_code": "271560", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 64.11314403406145, "signal_count": 1, "signal_list": "['\uac00\uc18d\ub3c4 5.6\ubc30']"}, {"name": "\uba54\uc9c0\uc628", "value": 63.94016988074287, "stock_code": "140410", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 63.94016988074287, "signal_count": 0, "signal_list": "[]"}, {"name": "\ub3d9\uc11c", "value": 63.543570451027506, "stock_code": "026960", "pattern": "\uae30\ud0c0", "combined_score": 63.543570451027506, "signal_count": 0, "signal_list": "[]"}, {"name": "\ub3d9\uc6d0\uc0b0\uc5c5", "value": 59.631485600140365, "stock_code": "006040", "pattern": "\uae30\ud0c0", "combined_score": 59.631485600140365, "signal_count": 0, "signal_list": "[]"}, {"name": "\ub300\uc0c1", "value": 58.794227969459754, "stock_code": "001680", "pattern": "\uae30\ud0c0", "combined_score": 58.794227969459754, "signal_count": 0, "signal_list": "[]"}]}, {"name": "\uc804\uc790 \uc7a5\ube44 \ubc0f \uae30\uae30", "children": [{"name": "\uc5d0\ucf54\ud504\ub85c\uba38\ud2f0", "value": 78.422047650913, "stock_code": "450080", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 78.422047650913, "signal_count": 0, "signal_list": "[]"}, {"name": "LG\uc5d0\ub108\uc9c0\uc194\ub8e8\uc158", "value": 75.2011663310737, "stock_code": "373220", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 75.2011663310737, "signal_count": 2, "signal_list": "['MA\ud06c\ub85c\uc2a4', '\uac00\uc18d\ub3c4 29.9\ubc30']"}, {"name": "\uc5d0\ucf54\ud504\ub85c\ube44\uc5e0", "value": 74.59351698261554, "stock_code": "247540", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 74.59351698261554, "signal_count": 1, "signal_list": "['MA\ud06c\ub85c\uc2a4']"}, {"name": "\uc528\uc544\uc774\uc5d0\uc2a4", "value": 73.12120128477089, "stock_code": "222080", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 73.12120128477089, "signal_count": 0, "signal_list": "[]"}, {"name": "\uc5d0\ucf54\ud504\ub85c", "value": 72.07572468391237, "stock_code": "086520", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 72.07572468391237, "signal_count": 1, "signal_list": "['\uac00\uc18d\ub3c4 1.9\ubc30']"}, {"name": "SK\uc544\uc774\uc774\ud14c\ud06c\ub180\ub85c\uc9c0", "value": 70.02592855248554, "stock_code": "361610", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 70.02592855248554, "signal_count": 0, "signal_list": "[]"}, {"name": "\uc5d4\ucf10", "value": 68.47636229669166, "stock_code": "348370", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 68.47636229669166, "signal_count": 0, "signal_list": "[]"}, {"name": "\ucc9c\ubcf4", "value": 65.0302633092515, "stock_code": "278280", "pattern": "\uae30\ud0c0", "combined_score": 65.0302633092515, "signal_count": 1, "signal_list": "['\uac00\uc18d\ub3c4 2.7\ubc30']"}, {"name": "\ud53c\uc5d4\ud2f0", "value": 63.121189547644406, "stock_code": "137400", "pattern": "\uc804\ud658\ud615", "combined_score": 63.121189547644406, "signal_count": 1, "signal_list": "['\uac00\uc18d\ub3c4 9.3\ubc30']"}, {"name": "\uc194\ube0c\ub808\uc778\ud640\ub529\uc2a4", "value": 62.75425714187076, "stock_code": "036830", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 62.75425714187076, "signal_count": 0, "signal_list": "[]"}]}, {"name": "\uc81c\uc57d", "children": [{"name": "\ub300\uc6c5\uc81c\uc57d", "value": 81.19024685581108, "stock_code": "069620", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 81.19024685581108, "signal_count": 2, "signal_list": "['MA\ud06c\ub85c\uc2a4', '\uac00\uc18d\ub3c4 3.3\ubc30']"}, {"name": "\ud55c\ubbf8\uc0ac\uc774\uc5b8\uc2a4", "value": 78.66352235993311, "stock_code": "008930", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 78.66352235993311, "signal_count": 1, "signal_list": "['MA\ud06c\ub85c\uc2a4']"}, {"name": "\uc885\uadfc\ub2f9", "value": 74.68699908202385, "stock_code": "185750", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 74.68699908202385, "signal_count": 0, "signal_list": "[]"}, {"name": "SK\ubc14\uc774\uc624\uc0ac\uc774\uc5b8\uc2a4", "value": 69.47404904069329, "stock_code": "302440", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 69.47404904069329, "signal_count": 0, "signal_list": "[]"}, {"name": "\ub300\uc6c5", "value": 69.24120245838591, "stock_code": "003090", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 69.24120245838591, "signal_count": 0, "signal_list": "[]"}, {"name": "\ub3d9\uad6d\uc81c\uc57d", "value": 68.85867031807174, "stock_code": "086450", "pattern": "\ubaa8\uba58\ud140\ud615", "combined_score": 68.85867031807174, "signal_count": 0, "signal_list": "[]"}, {"name": "\ubc14\uc774\ub125\uc2a4", "value": 67.1776748333588, "stock_code": "053030", "pattern": "\ubaa8\uba58\ud140\ud615", "combined_score": 67.1776748333588, "signal_count": 0, "signal_list": "[]"}, {"name": "\uc140\ud2b8\ub9ac\uc628\uc81c\uc57d", "value": 66.65589653662215, "stock_code": "068760", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 66.65589653662215, "signal_count": 0, "signal_list": "[]"}, {"name": "\uc720\ud55c\uc591\ud589", "value": 66.01311646152156, "stock_code": "000100", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 66.01311646152156, "signal_count": 0, "signal_list": "[]"}, {"name": "\uc624\uc2a4\ucf54\ud14d", "value": 64.2682790292547, "stock_code": "039200", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 64.2682790292547, "signal_count": 0, "signal_list": "[]"}]}, {"name": "\uac74\uc124", "children": [{"name": "\uc0bc\uc131E&A", "value": 73.3059394255484, "stock_code": "028050", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 73.3059394255484, "signal_count": 1, "signal_list": "['MA\ud06c\ub85c\uc2a4']"}, {"name": "LS\ub9c8\ub9b0\uc194\ub8e8\uc158", "value": 67.96803529088903, "stock_code": "060370", "pattern": "\ubaa8\uba58\ud140\ud615", "combined_score": 67.96803529088903, "signal_count": 0, "signal_list": "[]"}, {"name": "\ub300\uc6b0\uac74\uc124", "value": 67.76684094118475, "stock_code": "047040", "pattern": "\uc9c0\uc18d\ud615", "combined_score": 67.76684094118475, "signal_count": 1, "signal_list": "['\uac00\uc18d\ub3c4 4.2\ubc30']"}, {"name": "DL\uc774\uc564\uc528", "value": 54.096689242313666, "stock_code": "375500", "pattern": "\uae30\ud0c0", "combined_score": 54.096689242313666, "signal_count": 0, "signal_list": "[]"}, {"name": "GS\uac74\uc124", "value": 50.90758070890412, "stock_code": "006360", "pattern": "\uae30\ud0c0", "combined_score": 50.90758070890412, "signal_count": 0, "signal_list": "[]"}, {"name": "\ud604\ub300\uac74\uc124", "value": 45.30526526134759, "stock_code": "000720", "pattern": "\uae30\ud0c0", "combined_score": 45.30526526134759, "signal_count": 0, "signal_list": "[]"}]}]};

        // Treemap 설정
        const margin = {top: 80, right: 10, bottom: 10, left: 10};
        const width = 1200;
        const height = 800;

        // SVG 생성
        const svg = d3.select("#heatmap")
            .append("svg")
            .attr("width", width)
            .attr("height", height);

        // 툴팁 생성
        const tooltip = d3.select("body")
            .append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);

        // 색상 스케일 (종합점수 기반: 빨강 → 노랑 → 초록)
        const colorScale = d3.scaleSequential()
            .domain([40, 100])
            .interpolator(d3.interpolateRdYlGn);

        // 패턴 색상 매핑
        const patternColors = {
            '모멘텀형': '#EF4444',
            '지속형': '#3B82F6',
            '전환형': '#F59E0B'
        };

        // 배경색에 따라 텍스트 색상 자동 조정
        function getTextColor(bgColor) {
            const color = d3.color(bgColor);
            const luminance = 0.299 * color.r + 0.587 * color.g + 0.114 * color.b;
            return luminance > 140 ? '#1F2937' : '#FFFFFF';  // 밝으면 진한 회색, 어두우면 흰색
        }

        // 계층 구조 생성
        const root = d3.hierarchy(treemapData)
            .sum(d => d.value)
            .sort((a, b) => b.value - a.value);

        // Treemap 레이아웃
        const treemap = d3.treemap()
            .size([width, height - margin.top])
            .padding(1)
            .paddingOuter(2)
            .paddingTop(24)  // 섹터 이름 공간
            .round(true);

        treemap(root);

        // 메인 그룹 (상단 마진 적용)
        const mainGroup = svg.append("g")
            .attr("transform", `translate(0, ${margin.top})`);

        // 종목 박스 그리기
        const leaves = mainGroup.selectAll("g")
            .data(root.leaves())
            .enter()
            .append("g")
            .attr("transform", d => `translate(${d.x0},${d.y0})`);

        // 종목 박스
        leaves.append("rect")
            .attr("width", d => d.x1 - d.x0)
            .attr("height", d => d.y1 - d.y0)
            .attr("fill", d => colorScale(d.data.combined_score))
            .attr("stroke", "#FFFFFF")
            .attr("stroke-width", 1.5)
            .attr("rx", 3)  // 둥근 모서리
            .style("cursor", "pointer")
            .on("mouseover", function(event, d) {
                d3.select(this)
                    .attr("stroke", "#000000")
                    .attr("stroke-width", 2.5)
                    .style("filter", "brightness(1.1)");

                tooltip.transition().duration(150).style("opacity", 1);
                tooltip.html(`
                    <div style="border-bottom: 2px solid #60A5FA; padding-bottom: 8px; margin-bottom: 8px;">
                        <strong style="font-size: 17px; color: #60A5FA;">${d.data.name}</strong>
                    </div>
                    <div style="line-height: 1.8;">
                        <span style="color: #9CA3AF;">종목코드:</span> <strong style="color: #E5E7EB;">${d.data.stock_code}</strong><br/>
                        <span style="color: #9CA3AF;">섹터:</span> <strong style="color: #E5E7EB;">${d.parent.data.name}</strong><br/>
                        <span style="color: #9CA3AF;">패턴:</span> <span style="color: ${patternColors[d.data.pattern] || '#fff'}; font-weight: 600;">${d.data.pattern}</span><br/>
                        <span style="color: #9CA3AF;">종합점수:</span> <strong style="color: #34D399; font-size: 16px;">${d.data.combined_score.toFixed(1)}점</strong><br/>
                        <span style="color: #9CA3AF;">시그널:</span> <strong style="color: #FBBF24;">${d.data.signal_count}개</strong><br/>
                        <span style="color: #9CA3AF;">내용:</span> <span style="color: #E5E7EB;">${d.data.signal_list}</span>
                    </div>
                `)
                    .style("left", (event.pageX + 15) + "px")
                    .style("top", (event.pageY - 28) + "px");
            })
            .on("mouseout", function() {
                d3.select(this)
                    .attr("stroke", "#FFFFFF")
                    .attr("stroke-width", 1.5)
                    .style("filter", "none");
                tooltip.transition().duration(300).style("opacity", 0);
            });

        // 종목명 텍스트
        leaves.append("text")
            .attr("x", d => (d.x1 - d.x0) / 2)
            .attr("y", d => {
                const height = d.y1 - d.y0;
                return height > 50 ? (d.y1 - d.y0) / 2 - 5 : (d.y1 - d.y0) / 2;
            })
            .attr("text-anchor", "middle")
            .attr("dominant-baseline", "middle")
            .text(d => {
                const width = d.x1 - d.x0;
                const height = d.y1 - d.y0;
                // 박스가 충분히 크면 종목명 표시
                if (width > 70 && height > 35) {
                    return d.data.name.length > 8 ? d.data.name.substring(0, 7) + '...' : d.data.name;
                } else if (width > 45 && height > 25) {
                    return d.data.name.length > 5 ? d.data.name.substring(0, 4) + '...' : d.data.name;
                }
                return '';
            })
            .attr("font-size", d => {
                const width = d.x1 - d.x0;
                if (width > 120) return "14px";
                if (width > 80) return "12px";
                if (width > 50) return "10px";
                return "8px";
            })
            .attr("font-weight", "700")
            .attr("fill", d => getTextColor(colorScale(d.data.combined_score)))
            .style("pointer-events", "none");

        // 점수 텍스트
        leaves.append("text")
            .attr("x", d => (d.x1 - d.x0) / 2)
            .attr("y", d => {
                const height = d.y1 - d.y0;
                return height > 50 ? (d.y1 - d.y0) / 2 + 14 : (d.y1 - d.y0) / 2 + 12;
            })
            .attr("text-anchor", "middle")
            .attr("dominant-baseline", "middle")
            .text(d => {
                const width = d.x1 - d.x0;
                const height = d.y1 - d.y0;
                if (width > 70 && height > 45) {
                    return `${d.data.combined_score.toFixed(1)}점`;
                }
                return '';
            })
            .attr("font-size", "11px")
            .attr("font-weight", "600")
            .attr("fill", d => getTextColor(colorScale(d.data.combined_score)))
            .style("pointer-events", "none")
            .style("opacity", 0.9);

        // 섹터 레이블 (각 섹터 영역 내부 좌상단)
        const sectorGroups = root.children;
        sectorGroups.forEach(sector => {
            const sectorLeaves = sector.leaves();
            if (sectorLeaves.length === 0) return;

            // 섹터 영역의 x0, y0 계산
            const x0 = Math.min(...sectorLeaves.map(d => d.x0));
            const y0 = Math.min(...sectorLeaves.map(d => d.y0));
            const x1 = Math.max(...sectorLeaves.map(d => d.x1));

            // 섹터 배경 박스
            const labelWidth = Math.min(sector.data.name.length * 10 + 16, x1 - x0);
            mainGroup.append("rect")
                .attr("x", x0)
                .attr("y", y0)
                .attr("width", labelWidth)
                .attr("height", 22)
                .attr("fill", "rgba(31, 41, 55, 0.85)")
                .attr("rx", 4)
                .style("pointer-events", "none");

            // 섹터 텍스트
            mainGroup.append("text")
                .attr("x", x0 + 8)
                .attr("y", y0 + 14)
                .text(sector.data.name)
                .attr("font-size", "12px")
                .attr("font-weight", "700")
                .attr("fill", "#FFFFFF")
                .style("pointer-events", "none");
        });

        // 범례 추가 (상단 중앙)
        const legendWidth = 400;
        const legendHeight = 20;

        const legend = svg.append("g")
            .attr("transform", `translate(${(width - legendWidth) / 2}, 20)`);

        // 타이틀
        legend.append("text")
            .attr("x", legendWidth / 2)
            .attr("y", 0)
            .attr("text-anchor", "middle")
            .style("font-size", "16px")
            .style("font-weight", "700")
            .attr("fill", "#1F2937")
            .text("종합점수");

        // 그라데이션 정의
        const defs = svg.append("defs");
        const linearGradient = defs.append("linearGradient")
            .attr("id", "legend-gradient")
            .attr("x1", "0%")
            .attr("x2", "100%");

        linearGradient.selectAll("stop")
            .data(d3.range(0, 1.1, 0.1))
            .enter()
            .append("stop")
            .attr("offset", d => `${d * 100}%`)
            .attr("stop-color", d => colorScale(40 + d * 60));

        // 그라데이션 바
        legend.append("rect")
            .attr("y", 15)
            .attr("width", legendWidth)
            .attr("height", legendHeight)
            .style("fill", "url(#legend-gradient)")
            .attr("stroke", "#D1D5DB")
            .attr("stroke-width", 1)
            .attr("rx", 4);

        // 레이블 (낮음)
        legend.append("text")
            .attr("x", 0)
            .attr("y", legendHeight + 35)
            .attr("text-anchor", "start")
            .style("font-size", "13px")
            .style("font-weight", "600")
            .attr("fill", "#DC2626")
            .text("낮음 (40점)");

        // 레이블 (중간)
        legend.append("text")
            .attr("x", legendWidth / 2)
            .attr("y", legendHeight + 35)
            .attr("text-anchor", "middle")
            .style("font-size", "13px")
            .style("font-weight", "600")
            .attr("fill", "#F59E0B")
            .text("중간");

        // 레이블 (높음)
        legend.append("text")
            .attr("x", legendWidth)
            .attr("y", legendHeight + 35)
            .attr("text-anchor", "end")
            .style("font-size", "13px")
            .style("font-weight", "600")
            .attr("fill", "#059669")
            .text("높음 (100점)");
    </script>
</body>
</html>